@model SurveySystem.Models.Survey
@{
    ViewData["Title"] = "NonMemberSurvey";
    Layout = "~/Views/Shared/_NewAdminLayout.cshtml";
}
@section Styles{
    <style>
        .btn {
            font-size: 14px;
            padding: 5px 10px;
        }

        .toast-error {
            background-color: brown;
            color: white;
        }

        .toast-warning {
            background-color: darkorange;
            color: white;
        }

        .toast-success {
            background-color: darkgreen;
            color: white;
        }
    </style>
}
@section Scripts{
    <script type="text/javascript">
        var currentQuestionIndex = 0;

        var surveyData = {
            FirstName: "",
            LastName: "",
            Questions: []
        };

        $(document).ready(function () {
            // Sayfa yüklendiğinde ilk soruyu göster
            showQuestion(currentQuestionIndex);

            $("#surveyForm").submit(function (event) {
                var firstName = $("#FirstName").val().trim();
                var lastName = $("#LastName").val().trim();

                if (firstName === "" || lastName === "") {
                    alert("Lütfen adınızı ve soyadınızı eksiksiz olarak girin.");
                    event.preventDefault(); // Formun gönderimini engelle
                }
            });

            $(".btn-select").click(function () {
                // Seçilen sorunun kimlik numarasını ve doğru cevap seçeneğini al
                var questionIndex = currentQuestionIndex;

                // Checkbox'ın seçili olup olmadığını kontrol et
                if ($("#selectQuestion_" + (questionIndex + 1)).is(":checked")) {
                    var questionId = $("#questionId_" + (questionIndex + 1)).val(); // Soru kimlik numarasını hidden alanından al
                    var correctOptionId = $("input[name='Questions[" + questionIndex + "].CorrectOption']:checked").val();

                    // Verileri surveyData nesnesine ekle
                    surveyData.Questions.push({
                        QuestionId: parseInt(questionId),
                        CorrectOption: parseInt(correctOptionId)
                    });
                } else {
                    // Checkbox seçili değilse uyarı ver
                    toastr.warning("Lütfen soru seçiniz!");
                }

                // // İleri git
                // navigate(1);
            });


            $(".btnsave").click(function () {
                // Ad ve soyadı al
                surveyData.FirstName = $("#FirstName").val();
                surveyData.LastName = $("#LastName").val();

                // AJAX isteği gönder
                $.ajax({
                    url: "/Survey/NonMemberSurvey",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(surveyData),
                    success: function (response) {
                        // Başarılı yanıt alındığında işlemleri yapabilirsiniz
                        // Örneğin, teşekkür sayfasına yönlendirebilirsiniz
                        window.location.href = "@Url.Action("ThankYou")";
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        alert("Anket gönderimi sırasında bir hata oluştu.");
                    }
                });

                event.preventDefault(); // Formun gönderimini engelle
            });
        });

        function showQuestion(index) {
            $(".question").hide();
            $(".question:eq(" + index + ")").show();
        }

        function navigate(direction) {
            currentQuestionIndex += direction;
            if (currentQuestionIndex < 0) {
                currentQuestionIndex = 0;
            } else if (currentQuestionIndex >= @Model.Questions.Count) {
                currentQuestionIndex = @Model.Questions.Count - 1;
            }
            showQuestion(currentQuestionIndex);
        }
    </script>
}

<div class="col-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Anket Oluşturma</h4>
            @* <form id="surveyForm" asp-action="NonMemberSurvey" method="post"> *@
            <!-- Formun POST isteği gönderdiği bir endpoint belirtmelisiniz. -->
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label asp-for="FirstName">Ad</label>
                        <input asp-for="FirstName" type="text" class="form-control" id="FirstName" name="FirstName" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label asp-for="LastName">Soyad</label>
                        <input asp-for="LastName" type="text" class="form-control" id="LastName" name="LastName" required>
                    </div>
                </div>
            </div>
            <button class="btn btn-success btn-select" >Soru Ekle</button>
            <!-- Sorular burada görüntülenir -->
            @for (var i = 0; i < Model.Questions.Count; i++)
            {
                <div class="card mt-3 question">
                    <div class="card-body">
                        <!-- Soru kimlik numarasını saklamak için gizli bir alan ekleyin -->
@*                         <input type="hidden" id="questionId" value="@Model.Questions[i].Id" />
 *@                        
 
                    @* <input type="hidden" id="questionId_@(i + 1)" value="@Model.Questions[i].Id" /> *@
                       

                        <div class="form-check form-check-success">
                            <label class="form-check-label font-weight-bold">
                                <input type="checkbox" class="form-check-input" id="selectQuestion_@(i + 1)" name="Questions[@i].Selected"> @*card-title*@
                                Soru @(i + 1)
                            </label>
                            <input type="hidden" id="questionId_@(i + 1)" name="Questions[@i].QuestionId" value="@Model.Questions[i].Id" />
                        </div>


                        <div class="form-group">
                            <label for="question_@(i + 1)">Soru Metni</label>
                            <input type="text" class="form-control" id="question_@(i + 1)" name="Questions[@i].QuestionText" required value="@Model.Questions[i].QuestionText">
                           @*  <input type="hidden" value="@Model.Questions[i].Id" /> *@

                        </div>
                        <div class="form-group">
                            <label>Seçenekler</label>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option1_@(i + 1)" name="Questions[@i].CorrectOption" value="1">
                                <label class="form-check-label" for="option1_@(i + 1)">@(Model.Questions[i].Option1)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option2_@(i + 1)" name="Questions[@i].CorrectOption" value="2">
                                <label class="form-check-label" for="option2_@(i + 1)">@(Model.Questions[i].Option2)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option3_@(i + 1)" name="Questions[@i].CorrectOption" value="3">
                                <label class="form-check-label" for="option3_@(i + 1)">@(Model.Questions[i].Option3)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option4_@(i + 1)" name="Questions[@i].CorrectOption" value="4">
                                <label class="form-check-label" for="option4_@(i + 1)">@(Model.Questions[i].Option4)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option5_@(i + 1)" name="Questions[@i].CorrectOption" value="5">
                                <label class="form-check-label" for="option5_@(i + 1)">@(Model.Questions[i].Option5)</label>
                            </div>
                            <!-- Diğer seçenekler burada -->
                        </div>
                        <button class="btn btn-danger" onclick="removeQuestion(this)">Kaldır</button>
                    </div>
                </div>
            }

            <!-- İleri ve geri düğmeleri ekleyin -->
            <button class="btn btn-primary mt-3" id="prevButton" onclick="navigate(-1)">Önceki Soru</button>
            <button class="btn btn-primary mt-3" id="nextButton" onclick="navigate(1)">Sonraki Soru</button>

            <button type="submit" class="btn btn-primary mt-3 btnsave">Anketi Oluştur</button>
            @* </form> *@
        </div>
    </div>
</div>

@*
<div class="container">
    <h1>Anket Oluştur</h1>
    <div class="form-group">
        <label for="surveyTitle">Anket Başlığı:</label>
        <input type="text" class="form-control" id="surveyTitle" name="SurveyTitle" required>
    </div>
    <form id="surveyForm" asp-action="NonMemberSurvey" method="post">
        <!-- Formun POST isteği gönderdiği bir endpoint belirtmelisiniz. -->
        <div class="form-group">
            <label asp-for="FirstName">Ad</label>
            <input asp-for="FirstName" type="text" class="form-control" id="FirstName" name="FirstName" required>
        </div>
        <div class="form-group">
            <label asp-for="LastName">Soyad</label>
            <input asp-for="LastName" type="text" class="form-control" id="LastName" name="LastName" required>
        </div>
        <h2>Sorular</h2>
        <button class="btn btn-success" onclick="addQuestion()">Soru Ekle</button>
        <div id="questionsContainer">
            <!-- Sorular burada görüntülenir -->
            @for (var i = 0; i < Model.Questions.Count; i++)
            {
                <div class="card mt-3">
                    <div class="card-body">

                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="selectQuestion_@(i + 1)" name="Questions[@i].Selected">
                            <label class="form-check-label" for="selectQuestion_@(i + 1)">Soru Seç</label>
                        </div>
                        <h5 class="card-title">Soru @(i + 1)</h5>
                        <div class="form-group">
                            <label for="question_@(i + 1)">Sorunuz:</label>
                            <input type="text" class="form-control" id="question_@(i + 1)" name="Questions[@i].QuestionText" required value="@Model.Questions[i].QuestionText">
                        </div>
                        <div class="form-group">
                            <label>Şıklar:</label>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option1_@(i + 1)" name="Questions[@i].CorrectOption" value="Option1">
                                <label class="form-check-label" for="option1_@(i + 1)">@(Model.Questions[i].Option1)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option2_@(i + 1)" name="Questions[@i].CorrectOption" value="Option2">
                                <label class="form-check-label" for="option2_@(i + 1)">@(Model.Questions[i].Option2)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option3_@(i + 1)" name="Questions[@i].CorrectOption" value="Option3">
                                <label class="form-check-label" for="option3_@(i + 1)">@(Model.Questions[i].Option3)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option4_@(i + 1)" name="Questions[@i].CorrectOption" value="Option4">
                                <label class="form-check-label" for="option4_@(i + 1)">@(Model.Questions[i].Option4)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option5_@(i + 1)" name="Questions[@i].CorrectOption" value="Option5">
                                <label class="form-check-label" for="option5_@(i + 1)">@(Model.Questions[i].Option5)</label>
                            </div>
                            <!-- Diğer seçenekler burada -->
                        </div>
                        <button class="btn btn-danger" onclick="removeQuestion(this)">Kaldır</button>
                    </div>
                </div>
            }
        </div>

        <!-- İleri ve geri düğmeleri ekleyin -->
        <button class="btn btn-primary mt-3" id="prevButton" onclick="navigate(-1)">Önceki Soru</button>
        <button class="btn btn-primary mt-3" id="nextButton" onclick="navigate(1)">Sonraki Soru</button>

        <button type="submit" class="btn btn-primary mt-3">Anketi Oluştur</button>
    </form>
</div>
 *@




@* <html>
<body>
    <div class="container">
        <h1>Anket Oluştur</h1>
        <div class="form-group">
            <label for="surveyTitle">Anket Başlığı:</label>
            <input type="text" class="form-control" id="surveyTitle" name="SurveyTitle" required>
        </div>

        <h2>Sorular</h2>
        <button class="btn btn-success" onclick="addQuestion()">Soru Ekle</button>
        <div id="questionsContainer">
            <!-- Sorular burada görüntülenir -->
            @for (var i = 0; i < Model.Count; i++)
            {
                <div class="card mt-3">
                    <div class="card-body">
                        <h5 class="card-title">Soru @(i + 1)</h5>
                        <div class="form-group">
                            <label for="question_@(i + 1)">Sorunuz:</label>
                            <input type="text" class="form-control" id="question_@(i + 1)" name="Questions[@i].QuestionText" required value="@Model[i].QuestionText">
                        </div>
                        <div class="form-group">
                            <label>Şıklar:</label>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option1_@(i + 1)" name="Questions[@i].CorrectOption" value="Option1">
                                <label class="form-check-label" for="option1_@(i + 1)">@(Model[i].Option1)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option2_@(i + 1)" name="Questions[@i].CorrectOption" value="Option2">
                                <label class="form-check-label" for="option2_@(i + 1)">@(Model[i].Option2)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option3_@(i + 1)" name="Questions[@i].CorrectOption" value="Option3">
                                <label class="form-check-label" for="option3_@(i + 1)">@(Model[i].Option3)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option4_@(i + 1)" name="Questions[@i].CorrectOption" value="Option4">
                                <label class="form-check-label" for="option4_@(i + 1)">@(Model[i].Option4)</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option5_@(i + 1)" name="Questions[@i].CorrectOption" value="Option5">
                                <label class="form-check-label" for="option5_@(i + 1)">@(Model[i].Option5)</label>
                            </div>
                        </div>
                        <button class="btn btn-danger" onclick="removeQuestion(this)">Kaldır</button>
                    </div>
                </div>
            }
        </div>

        <button type="submit" class="btn btn-primary mt-3">Anketi Oluştur</button>
    </div>

    <script>
        // Soru sayacı
        var questionCounter = @Model.Count; // Mevcut soru sayısını al

        // Yeni bir soru eklemek için fonksiyon
        function addQuestion() {
            questionCounter++;
            var questionHtml = `
                <div class="card mt-3">
                    <div class="card-body">
                        <h5 class="card-title">Soru ${questionCounter}</h5>
                        <div class="form-group">
                            <label for="question_${questionCounter}">Sorunuz:</label>
                            <input type="text" class="form-control" id="question_${questionCounter}" name="Questions[${questionCounter - 1}].QuestionText" required>
                        </div>
                        <div class="form-group">
                            <label>Şıklar:</label>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option1_${questionCounter}" name="Questions[${questionCounter - 1}].CorrectOption" value="Option1">
                                <label class="form-check-label" for="option1_${questionCounter}">Şık 1</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option2_${questionCounter}" name="Questions[${questionCounter - 1}].CorrectOption" value="Option2">
                                <label class="form-check-label" for="option2_${questionCounter}">Şık 2</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option3_${questionCounter}" name="Questions[${questionCounter - 1}].CorrectOption" value="Option3">
                                <label class="form-check-label" for="option3_${questionCounter}">Şık 3</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option4_${questionCounter}" name="Questions[${questionCounter - 1}].CorrectOption" value="Option4">
                                <label class="form-check-label" for="option4_${questionCounter}">Şık 4</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="option5_${questionCounter}" name="Questions[${questionCounter - 1}].CorrectOption" value="Option5">
                                <label class="form-check-label" for="option5_${questionCounter}">Şık 5</label>
                            </div>
                        </div>
                        <button class="btn btn-danger" onclick="removeQuestion(this)">Kaldır</button>
                    </div>
                </div>
            `;
            $("#questionsContainer").append(questionHtml);
        }

        // Soru kaldırmak için fonksiyon
        function removeQuestion(button) {
            $(button).closest(".card").remove();
        }
    </script>
</body>
</html> *@


